#
#Test CREATE VIEW in Columnstore
#
-- source ../include/have_columnstore.inc

--disable_warnings
DROP DATABASE IF EXISTS mcs15_db;
--enable_warnings

CREATE DATABASE mcs15_db;
USE mcs15_db;

CREATE TABLE t1(id INT)ENGINE=Columnstore;
CREATE VIEW IF NOT EXISTS v1 AS SELECT * FROM t1 WHERE id>10;
INSERT INTO t1 VALUES (5), (8), (10), (20), (30);
SELECT * FROM t1;
SELECT * FROM v1;
--error 1146
SELECT * FROM v2;

--error 1050
CREATE VIEW v1 AS SELECT * FROM t1 WHERE id>11;
SELECT VIEW_DEFINITION FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME='v1' AND TABLE_SCHEMA='mcs15_db';

CREATE VIEW IF NOT EXISTS v1 AS SELECT * FROM t1 WHERE id>12;
SELECT VIEW_DEFINITION FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME='v1' AND TABLE_SCHEMA='mcs15_db';

--error 1221
CREATE OR REPLACE VIEW IF NOT EXISTS v1 AS SELECT * FROM t1 WHERE id>13;
SELECT VIEW_DEFINITION FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME='v1' AND TABLE_SCHEMA='mcs15_db';

CREATE OR REPLACE VIEW v1 AS SELECT * FROM t1 WHERE id>40;
SELECT VIEW_DEFINITION FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_NAME='v1' AND TABLE_SCHEMA='mcs15_db';

INSERT INTO t1 VALUES (50), (80), (3), (2), (40);
SELECT * FROM t1;
SELECT * FROM v1;

--error 1965
DROP TABLE v1;
DROP TABLE IF EXISTS v1;
--error 4092
DROP VIEW v2;

DROP TABLE t1;
--error 1356
SELECT * FROM v1;

DROP VIEW IF EXISTS v1;
DROP VIEW IF EXISTS t1;

DROP DATABASE mcs15_db;

DROP DATABASE IF EXISTS mcs221_db;
CREATE DATABASE mcs221_db;
USE mcs221_db;
CREATE TABLE t1(t1_d DATE, t1_t TIME, t1_dt DATETIME)ENGINE=Columnstore;
INSERT INTO t1 VALUES(NULL, NULL, NULL);
INSERT INTO t1 VALUES('2222-11-11', '12:12:12', '2020-11-11 12:12:12');
INSERT INTO t1 VALUES('2020-01-01', '11:11:11', '2020-12-31 12:34:56');
INSERT INTO t1 VALUES('2016-02-01', '11:11:11', '2017-02-01 12:12:12');
SELECT PERIOD_DIFF(200101, 199901);
PERIOD_DIFF(200101, 199901)
24
SELECT PERIOD_DIFF(200101, 200012);
PERIOD_DIFF(200101, 200012)
1
SELECT PERIOD_DIFF(201001, 200001);
PERIOD_DIFF(201001, 200001)
120
SELECT PERIOD_DIFF(201505, 202005);
PERIOD_DIFF(201505, 202005)
-60
SELECT t1_dt, EXTRACT(YEAR_MONTH FROM t1_dt), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_dt), 202011) FROM t1;
t1_dt	EXTRACT(YEAR_MONTH FROM t1_dt)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_dt), 202011)
NULL	NULL	NULL
2020-11-11 12:12:12	202011	0
2020-12-31 12:34:56	202012	1
2017-02-01 12:12:12	201702	-45
SELECT t1_dt, EXTRACT(YEAR_MONTH FROM t1_dt), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_dt), 222212) FROM t1;
t1_dt	EXTRACT(YEAR_MONTH FROM t1_dt)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_dt), 222212)
NULL	NULL	NULL
2020-11-11 12:12:12	202011	-2425
2020-12-31 12:34:56	202012	-2424
2017-02-01 12:12:12	201702	-2470
SELECT t1_dt, EXTRACT(YEAR_MONTH FROM t1_dt), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_dt), 201001) FROM t1;
t1_dt	EXTRACT(YEAR_MONTH FROM t1_dt)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_dt), 201001)
NULL	NULL	NULL
2020-11-11 12:12:12	202011	130
2020-12-31 12:34:56	202012	131
2017-02-01 12:12:12	201702	85
SELECT t1_d, EXTRACT(YEAR_MONTH FROM t1_d), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_d), 202011) FROM t1;
t1_d	EXTRACT(YEAR_MONTH FROM t1_d)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_d), 202011)
NULL	NULL	NULL
2222-11-11	222211	2424
2020-01-01	202001	-10
2016-02-01	201602	-57
SELECT t1_d, EXTRACT(YEAR_MONTH FROM t1_d), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_d), 222212) FROM t1;
t1_d	EXTRACT(YEAR_MONTH FROM t1_d)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_d), 222212)
NULL	NULL	NULL
2222-11-11	222211	-1
2020-01-01	202001	-2435
2016-02-01	201602	-2482
SELECT t1_t, EXTRACT(YEAR_MONTH FROM t1_t), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t), 202211) FROM t1;
t1_t	EXTRACT(YEAR_MONTH FROM t1_t)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t), 202211)
NULL	NULL	NULL
12:12:12	0	-24274
11:11:11	0	-24274
11:11:11	0	-24274
SELECT t1_t, EXTRACT(YEAR_MONTH FROM t1_t), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t), 201001) FROM t1;
t1_t	EXTRACT(YEAR_MONTH FROM t1_t)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t), 201001)
NULL	NULL	NULL
12:12:12	0	-24120
11:11:11	0	-24120
11:11:11	0	-24120
SELECT t1_t, EXTRACT(YEAR_MONTH FROM t1_t), PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t), 202001) FROM t1;
t1_t	EXTRACT(YEAR_MONTH FROM t1_t)	PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t), 202001)
NULL	NULL	NULL
12:12:12	0	-24240
11:11:11	0	-24240
11:11:11	0	-24240
SELECT PERIOD_DIFF(EXTRACT(YEAR_MONTH FROM t1_t)) FROM t1;
ERROR 42000: Incorrect parameter count in the call to native function 'PERIOD_DIFF'
DROP DATABASE mcs221_db;
